<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script src="lib/jquery/jquery-1.7.1.min.js"></script>
    <script src="lib/layui/layui.js"></script>

</head>
<body>
<script>
    function contact_customer_service() {

//                var websocket = null;
//
//                //判断当前浏览器是否支持WebSocket
//                if ('WebSocket' in window) {
//                    websocket = new WebSocket(email.url.websocket);
//                }
//                else {
//                    alert('Not support websocket')
//                }
//
//                //连接发生错误的回调方法
//                websocket.onerror = function () {
//                    console.log("error");
//                };
//
//                //连接成功建立的回调方法
//                websocket.onopen = function (event) {
//
//                };
//
//                //接收到消息的回调方法   event.data
//                websocket.onmessage = function (event) {
//                    vm.websocket(event.data);
//                };
//
//                //连接关闭的回调方法
//                websocket.onclose = function () {
//
//                };
//
//                //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
//                window.onbeforeunload = function () {
//                    websocket.close();
//                };
//
//                //关闭连接
//                function closeWebSocket() {
//                    websocket.close();
//                }
//
//                //发送消息
//                function send() {
//                    var message = document.getElementById('text').value;
//                    websocket.send(message);
//                }

        layui.use('layim', function (layim) {
            //基础配置
            layim.config({
                brief: true, //是否简约模式（如果true则不显示主面板）
                minRight: '10px',
                init: {
                    mine: {
                        username: "纸飞机" //我的昵称
                        , id: "100000" //我的ID
                        , status: "online" //在线状态 online：在线、hide：隐身
                        , sign: "在深邃的编码世界，做一枚轻盈的纸飞机" //我的签名
                        , avatar: "http://tp1.sinaimg.cn/5619439268/180/40030060651/1" //我的头像
                    }
                } //获取主面板列表信息，下文会做进一步介绍


                //上传图片接口（返回的数据格式见下文），若不开启图片上传，剔除该项即可
                , uploadImage: {
                    url: '', //接口地址
                    type: 'post', //默认post
                }

                //上传文件接口（返回的数据格式见下文），若不开启文件上传，剔除该项即可
                , uploadFile: {
                    url: '', //接口地址
                    type: 'post', //默认post
                }
            }).chat({
                name: '客服',
                type: 'friend',
                avatar: 'http://tp1.sinaimg.cn/5619439268/180/40030060651/1',
                id: -2
            }).on('sendMessage', function (res) {
                console.log(res);
                var mine = res.mine;
                var to = res.to; //对方的信息
                //监听到上述消息后，就可以轻松地发送socket了，如：
                websocket.send(JSON.stringify({
                    type: 'chatMessage' //随便定义，用于在服务端区分消息类型
                    , data: res
                }));
                //获取收到的消息
                websocket.onmessage = function (res) {
                    res = JSON.parse(res);
                    if (res.emit === 'chatMessage') {
                        layim.getMessage(res.data); //res.data即你发送消息传递的数据（阅读：监听发送的消息）
                    }
                };
            }).setChatMin();
        });
    }
</script>
</body>
</html>