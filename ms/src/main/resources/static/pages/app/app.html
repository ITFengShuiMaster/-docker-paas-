<style>
    .text {
        color: #495060;
        margin-top: 8px;
        margin-right: 15px;
    }

    p {
        font-size: 14px;
        color: #495060;
        margin-top: 8px;
        margin-right: 8px;
    }
    .ivu-table{
         height:auto;
     }
    .m{
        margin-left: 10px;
        font-size: 15px;
    }

</style>
<body>
<div id="app_management">
    <div style="margin: 10px 20px; display: inline-flex">
        <p>ä¸»é¡µ</p>
        <p>/</p>
        <p style="font-weight: bold">åº”ç”¨ç®¡ç†</p>
    </div>
    <div style="margin: 10px 20px">
        <p style="font-size: 20px; color: black">ç”¨æˆ·ç®¡ç†</p>
        <p style="margin: 8px 0px 20px">æŸ¥è¯¢ç”¨æˆ·åº”ç”¨ä½¿ç”¨æƒ…å†µ</p>
    </div>
    <div style="display: inline-flex; padding-left: 20px;padding-bottom: 15px">
        <p class="text">æŸ¥è¯¢æ¡ä»¶:</p>
        <i-input v-model="value" placeholder="è¯·è¾“å…¥åº”ç”¨å" style="width: 300px; margin-right: 15px"></i-input>
        <i-button type="primary" style:>æŸ¥è¯¢</i-button>
    </div>
    <i-table stripe border :columns="columns1" :data="table_data" style="margin:10px 20px"></i-table>
    <div style="margin-left: 40%">
        <Page :total="Total" @on-change="get_app_inf">

        </Page>
    </div>

</div>

</body>
<script>
    var app_management = new Vue({
        el: '#app_management',
        data: {
            Total: '100',
            value: '',
            table_data: [],
            columns1: [
                {
                    title: 'åº”ç”¨åç§°',
                    key: 'name',
                },
                {
                    title: 'åˆ›å»ºç”¨æˆ·',
                    key: 'username'
                },
                {
                    title: 'åº”ç”¨ä½¿ç”¨çš„å†…å­˜é‡',
                    key: 'memoryUsed'
                },
                {
                    title: 'åº”ç”¨çŠ¶æ€',
                    key: 'status',
                    render: (h, param) => {
                        return h('div', [
                            h('Tag', {
                                props: {
                                    color: (param.row.status === true)?'blue':'red',
                                    name: 'tt',
                                    value: 'tt'
                                },
                                on: {}
                            }, param.row.statusName)
                        ])
                    }
                },
                {
                    title: 'çŠ¶æ€æ”¹å˜',
                    key: 'status',
                    render: (h, params) => {
                        return h('div', [
                            h('i-switch', {
                                props: {
                                    //trueå’Œfalseåˆ¤æ–­å¼€å…³
                                    value: params.row.status,
                                },
                                style: {
                                    marginRight: '5px'
                                },
                                on: {
                                    'on-change': (change_status) => {//è§¦å‘äº‹ä»¶æ˜¯on-change,ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œ
                                        //å‚æ•°valueæ˜¯å›è°ƒå€¼ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨åˆ°
                                        //params.indexæ˜¯æ‹¿åˆ°tableçš„è¡Œåºåˆ—ï¼Œå¯ä»¥å–åˆ°å¯¹åº”çš„è¡¨
                                        app_management.convertStatus(params.index)
                                    }
                                }
                            }),
                        ]);
                    }
                },
                {
                    title: 'å±äºåº”ç”¨ç»„',
                    key: 'groupName'
                },
                {
                    title: 'åˆ›å»ºæ—¶é—´',
                    key: 'gmtCreate'
                },
                {
                    title: 'æ“ä½œ',
                    key: 'action',
                    width: 250,
                    align: 'center',
                    render: (h, params) => {
                        return h('div', [
                            h('Button', {
                                props: {
                                    type: 'primary',
                                },
                                style: {
                                    marginRight: '5px'
                                },
                                on: {
                                    click: () => {
                                        console.log(params);
                                        app_management.show(params.index)
                                    }
                                }
                            }, 'æŸ¥çœ‹'),
                            h('Button', {
                                props: {
                                    type: 'error',
                                },
                                on: {
                                    click: () => {
                                        app_management.remove(params.index)
                                    }
                                }
                            }, 'åˆ é™¤')
                        ]);
                    }
                }

            ]
        },
        methods: {
            get_app_inf(row) {
                var that = this
                $.ajax({
                    type: 'get',
                    url: 'apps',
                    data: {
                        current: row,
                    },
                    success: function (result) {
                        //ğŸ˜€
                        console.log(result);
                        app_management.Total = result.data.records.Total;
                        if (result.code === 1) {
                           for(var i=0;i<result.data.records.length;i++) {
                               that.table_data.push(result.data.records[i])
                               if(that.table_data[i].status === 0) {
                                   that.table_data[i].status = false
                                   that.table_data[i].statusName="å…³é—­"
                               }
                               else if(that.table_data[i].status === 1){
                                   that.table_data[i].status = true
                                   that.table_data[i].statusName="è¿è¡Œä¸­"

                               }
                               else if(that.table_data[i].status === 2){
                                   that.table_data[i].status = true
                                   that.table_data[i].statusName="å¼‚å¸¸"
                               }
                           }
                           console.log(that.table_data)
                        } else {
                            alert("è¯·æ±‚å‡ºç°é—®é¢˜å•¦" + result.message)
                        }
                    }
                })
            },
            show(index) {
                this.$Modal.info({
                    content: `<p class="m">åº”ç”¨åï¼š${this.table_data[index].name}</p><br><p class="m">æ‰€å±ç”¨æˆ·ï¼š${this.table_data[index].username}</p><br><p class="m">åº”ç”¨ä½¿ç”¨çš„å†…å­˜é‡ï¼š
                    ${this.table_data[index].memoryUsed}</p><br><p class="m">åº”ç”¨çŠ¶æ€ï¼š${this.table_data[index].statusName}</p><br>
                    <p class="m">æ‰€å±åº”ç”¨ç»„ï¼š${this.table_data[index].appGroupId}</p><br><p class="m">åˆ›å»ºæ—¶é—´ï¼š${this.table_data[index].gmtCreate}</p>`
                })
            },
            remove(index) {
                this.$Modal.confirm({
                    content: 'æ˜¯å¦ç¡®è®¤åˆ é™¤ï¼Ÿ',
                    onOk: () => {
                        this.deleteApp(this.table_data[index].appId);
                        this.table_data.splice(index, 1);
                        this.$Message.info('å·²åˆ é™¤');
                    },
                    onCancel: () => {
                        this.$Message.info('Clicked cancel');
                    }
                });
            },
            convertStatus(index) {
                console.log(index);
                var flag;
                if(this.table_data[index].status === true) {
                    flag = 0
                }
                else {
                    flag = 1
                }
                var that = this;
                $.ajax({
                    type:'put',
                    url:'apps',
                    dataType:'json',
                    data:{
                        appId:that.table_data[index].appId,
                        status:flag
                    },
                    success:function (data) {
                        console.log(data);
                        if(flag === 1) {
                            that.table_data[index].status = true;
                            that.table_data[index].statusName = "è¿è¡Œä¸­"
                        }
                        else {
                            that.table_data[index].status = false;
                            that.table_data[index].statusName = "å…³é—­"
                        }

                    },
                    error:function (err) {
                        console.log(err);
                    }
                })
            },
            deleteApp(app_id) {
                var that = this;
                $.ajax({
                    type:'delete',
                    url:'apps/'+ app_id
                    ,
                    success:function (data) {
                        if(data.code) {
                            that.$Message.info('delete successfully');
                        }
                    },
                    error:function (err) {
                        console.log(err);
                    }
                })
            }
        },
        mounted() {
            this.get_app_inf();
        }
    })
</script>